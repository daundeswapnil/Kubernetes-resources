# write down commands to install a k8s cluster on amazon linux 2

# 1. Update the installed packages and package cache on your instance.
sudo yum update -y
# 1. Install docker
sudo yum install docker -y

# 2. Start docker service
sudo systemctl start docker

# 3. start docker on boot
sudo systemctl enable docker

# 4. Add ec2-user to docker group
sudo usermod -a -G docker ec2-user

# 5. Install kubectl
curl -O https://s3.us-west-2.amazonaws.com/amazon-eks/1.26.2/2023-03-17/bin/linux/amd64/kubectl


# 6. Make the kubectl binary executable.
chmod +x ./kubectl

# 8. Verify kubectl is installed
kubectl version --client

# 9. Move the kubectl executable to /usr/local/bin.
sudo mv ./kubectl /usr/local/bin/kubectl

# 10. Install minikube
curl -LO https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64

# 11. Make the minikube binary executable.and move it to /usr/local/bin.
sudo install minikube-linux-amd64 /usr/local/bin/minikube

# 12. Verify minikube is installed correctly
minikube version

# 13. Start minikube
minikube start --driver=docker

# 14. Verify kubectl is installed
kubectl version --client

# 15. Install Kustomize
curl --silent --location --remote-name \
"https://github.com/kubernetes-sigs/kustomize/releases/download/kustomize/v3.2.3/kustomize_kustomize.v3.2.3_linux_amd64" && \
chmod a+x kustomize_kustomize.v3.2.3_linux_amd64 && \
sudo mv kustomize_kustomize.v3.2.3_linux_amd64 /usr/local/bin/kustomize

# 16. check kustomize version
kustomize version

# 17. hashicorp consul https://developer.hashicorp.com/consul/downloads
sudo yum install -y yum-utils shadow-utils
sudo yum-config-manager --add-repo https://rpm.releases.hashicorp.com/AmazonLinux/hashicorp.repo
sudo yum -y install consul

# 18. helm install https://helm.sh/docs/intro/install/
curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3
chmod 700 get_helm.sh
./get_helm.sh

# 19. argocd install https://argo-cd.readthedocs.io/en/stable/getting_started/
# 20. argocd cli https://argo-cd.readthedocs.io/en/stable/cli_installation/ 
curl -sSL -o argocd-linux-amd64 https://github.com/argoproj/argo-cd/releases/latest/download/argocd-linux-amd64
sudo install -m 555 argocd-linux-amd64 /usr/local/bin/argocd
rm argocd-linux-amd64

# 21. hashicorp vault https://developer.hashicorp.com/vault/downloads
sudo yum install -y yum-utils shadow-utils
sudo yum-config-manager --add-repo https://rpm.releases.hashicorp.com/AmazonLinux/hashicorp.repo
sudo yum -y install vault
